Двухфакторная авторизация с помощью 2fa library



1) Получаем от пользователя логин и пароль (через форму)

2)Если пароль верный (сравниваем с паролем в бд.В бд пароли храним в хэшированном виде. Сравниваем переданный хэшированный пароль с помощью функции Hash::check('переданный пароль', 'хэшированный пароль' ))

возвращаем authKey (чтобы понимать, какой именно пользователь его ввел). И ждем от пользоваетля authKey и код двухфакторной авторизации, который действует 30 секунд.

3) Изначально, секретный ключ генерируется и хранится на сервере (используется 2fa библиотека => $user->twofa_secret = $manager->generateSecretKey();). Если пользователь подключает
двухфакторную авторизацию,  ключ может быть выслан с помощью QR кода.

4) Далее, пользователь присылает код, который сравнивается с секретным ключом

$valid = $manager->verify($_POST['key'], $user->twofa_secret);